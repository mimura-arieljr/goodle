import { prepareQuestionSet } from "../utils/questionsManager.js";
import { isAnswerValid } from "../utils/answersManager.js";
import { startCountdownTimer } from "../utils/timerManager.js";
import { resultsView } from "./resultsView.js";
const answerInput = document.getElementById("answer-input");
const correctAnswer = document.getElementById("correct-answer-text");
const CORRECT_BORDER_COLOR = "border-green";
const INCORRECT_BORDER_COLOR = "border-red";
export async function questionsView(subjectsPage, questionsPage, subject) {
    const backBtn = document.getElementById("questions-back-btn");
    const submitBtn = document.getElementById("answer-submit-btn");
    let score = 0;
    let currentQuestionIndex = 0;
    // Event listeners
    backBtn.addEventListener("click", () => {
        subjectsPage.classList.remove("hidden");
        questionsPage.classList.add("hidden");
    });
    // Use onclick instead of eventListener
    // Avoid listener getting stacked multiple times on the same button. 
    // This causes handleAnswerSubmission() to be called more than once â€” even with outdated state. 
    submitBtn.onclick = handleAnswerSubmission;
    // Prepare and show the questions
    const questions = await prepareQuestionSet(subject);
    showQuestion(currentQuestionIndex, questions);
    // Handle answer submit
    function handleAnswerSubmission() {
        const userAnswer = answerInput.value;
        const isValid = isAnswerValid(userAnswer, questions[currentQuestionIndex]);
        handleAnswerFeedback(isValid);
        if (!isValid) {
            correctAnswer.classList.remove("invisible");
            correctAnswer.innerText = `Correct Answer: ${questions[currentQuestionIndex].Answer}`;
        }
        submitBtn.disabled = true;
        setTimeout(() => {
            answerInput.classList.remove(INCORRECT_BORDER_COLOR, CORRECT_BORDER_COLOR);
            correctAnswer.classList.add("invisible");
            submitBtn.disabled = false;
            moveToNextQuestion();
        }, 2000);
    }
    function moveToNextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            showQuestion(currentQuestionIndex, questions);
        }
        else {
            console.log("All questions completed!");
            resultsView(subjectsPage, questionsPage, score);
        }
    }
    function showQuestion(index, questions) {
        const questionTextEl = document.getElementById("question-text");
        const choicesContainer = document.getElementById("choices-container");
        const q = questions[index];
        questionTextEl.innerText = q.Question;
        answerInput.value = "";
        choicesContainer.innerHTML = "";
        // TODO: Handle multiple choice
        // Start countdown timer on each question
        startCountdownTimer(handleAnswerSubmission);
    }
    function handleAnswerFeedback(isCorrect) {
        if (isCorrect) {
            answerInput.classList.add(CORRECT_BORDER_COLOR);
            score++;
        }
        else {
            answerInput.classList.add(INCORRECT_BORDER_COLOR);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlc3Rpb25zVmlldy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy92aWV3cy9xdWVzdGlvbnNWaWV3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMvRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFL0MsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQXFCLENBQUM7QUFDaEYsTUFBTSxhQUFhLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBZ0IsQ0FBQztBQUNwRixNQUFNLG9CQUFvQixHQUFHLGNBQWMsQ0FBQztBQUM1QyxNQUFNLHNCQUFzQixHQUFHLFlBQVksQ0FBQztBQUU1QyxNQUFNLENBQUMsS0FBSyxVQUFVLGFBQWEsQ0FBQyxZQUF5QixFQUFFLGFBQTBCLEVBQUUsT0FBZTtJQUN0RyxNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLG9CQUFvQixDQUFzQixDQUFDO0lBQ25GLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQXNCLENBQUM7SUFDcEYsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2QsSUFBSSxvQkFBb0IsR0FBRyxDQUFDLENBQUM7SUFFN0Isa0JBQWtCO0lBQ2xCLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFO1FBQ25DLFlBQVksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3hDLGFBQWEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzFDLENBQUMsQ0FBQyxDQUFDO0lBRUgsdUNBQXVDO0lBQ3ZDLHFFQUFxRTtJQUNyRSxnR0FBZ0c7SUFDaEcsU0FBUyxDQUFDLE9BQU8sR0FBRyxzQkFBc0IsQ0FBQztJQUUzQyxpQ0FBaUM7SUFDakMsTUFBTSxTQUFTLEdBQUcsTUFBTSxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNwRCxZQUFZLENBQUMsb0JBQW9CLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFFOUMsdUJBQXVCO0lBQ3ZCLFNBQVMsc0JBQXNCO1FBQzNCLE1BQU0sVUFBVSxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUM7UUFDckMsTUFBTSxPQUFPLEdBQUcsYUFBYSxDQUFDLFVBQVUsRUFBRSxTQUFTLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO1FBRTNFLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTlCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNYLGFBQWEsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzVDLGFBQWEsQ0FBQyxTQUFTLEdBQUcsbUJBQW1CLFNBQVMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzFGLENBQUM7UUFFRCxTQUFTLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUUxQixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ1osV0FBVyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsc0JBQXNCLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztZQUMzRSxhQUFhLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUN6QyxTQUFTLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztZQUUzQixrQkFBa0IsRUFBRSxDQUFDO1FBQ3pCLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNiLENBQUM7SUFFRCxTQUFTLGtCQUFrQjtRQUN2QixvQkFBb0IsRUFBRSxDQUFDO1FBQ3ZCLElBQUksb0JBQW9CLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQzFDLFlBQVksQ0FBQyxvQkFBb0IsRUFBRSxTQUFTLENBQUMsQ0FBQztRQUNsRCxDQUFDO2FBQU0sQ0FBQztZQUNKLE9BQU8sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQztZQUN4QyxXQUFXLENBQUMsWUFBWSxFQUFFLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNwRCxDQUFDO0lBQ0wsQ0FBQztJQUVELFNBQVMsWUFBWSxDQUFDLEtBQWEsRUFBRSxTQUE2QjtRQUM5RCxNQUFNLGNBQWMsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLGVBQWUsQ0FBZ0IsQ0FBQztRQUMvRSxNQUFNLGdCQUFnQixHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQWdCLENBQUM7UUFFckYsTUFBTSxDQUFDLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNCLGNBQWMsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQztRQUN0QyxXQUFXLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUN2QixnQkFBZ0IsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBRWhDLCtCQUErQjtRQUUvQix5Q0FBeUM7UUFDekMsbUJBQW1CLENBQUMsc0JBQXNCLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQsU0FBUyxvQkFBb0IsQ0FBQyxTQUFrQjtRQUM1QyxJQUFJLFNBQVMsRUFBRSxDQUFDO1lBQ1osV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUNoRCxLQUFLLEVBQUUsQ0FBQztRQUNaLENBQUM7YUFBTSxDQUFDO1lBQ0osV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUN0RCxDQUFDO0lBQ0wsQ0FBQztBQUVMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlUXVlc3Rpb25UeXBlIH0gZnJvbSBcIi4uL3R5cGVzL0Jhc2VRdWVzdGlvblR5cGUuanNcIjtcbmltcG9ydCB7IHByZXBhcmVRdWVzdGlvblNldCB9IGZyb20gXCIuLi91dGlscy9xdWVzdGlvbnNNYW5hZ2VyLmpzXCI7XG5pbXBvcnQgeyBpc0Fuc3dlclZhbGlkIH0gZnJvbSBcIi4uL3V0aWxzL2Fuc3dlcnNNYW5hZ2VyLmpzXCI7XG5pbXBvcnQgeyBzdGFydENvdW50ZG93blRpbWVyIH0gZnJvbSBcIi4uL3V0aWxzL3RpbWVyTWFuYWdlci5qc1wiO1xuaW1wb3J0IHsgcmVzdWx0c1ZpZXcgfSBmcm9tIFwiLi9yZXN1bHRzVmlldy5qc1wiO1xuXG5jb25zdCBhbnN3ZXJJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYW5zd2VyLWlucHV0XCIpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG5jb25zdCBjb3JyZWN0QW5zd2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb3JyZWN0LWFuc3dlci10ZXh0XCIpIGFzIEhUTUxFbGVtZW50O1xuY29uc3QgQ09SUkVDVF9CT1JERVJfQ09MT1IgPSBcImJvcmRlci1ncmVlblwiO1xuY29uc3QgSU5DT1JSRUNUX0JPUkRFUl9DT0xPUiA9IFwiYm9yZGVyLXJlZFwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcXVlc3Rpb25zVmlldyhzdWJqZWN0c1BhZ2U6IEhUTUxFbGVtZW50LCBxdWVzdGlvbnNQYWdlOiBIVE1MRWxlbWVudCwgc3ViamVjdDogc3RyaW5nKSB7XG4gICAgY29uc3QgYmFja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicXVlc3Rpb25zLWJhY2stYnRuXCIpIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuICAgIGNvbnN0IHN1Ym1pdEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYW5zd2VyLXN1Ym1pdC1idG5cIikgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgbGV0IHNjb3JlID0gMDtcbiAgICBsZXQgY3VycmVudFF1ZXN0aW9uSW5kZXggPSAwO1xuXG4gICAgLy8gRXZlbnQgbGlzdGVuZXJzXG4gICAgYmFja0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBzdWJqZWN0c1BhZ2UuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICAgICAgcXVlc3Rpb25zUGFnZS5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xuXG4gICAgLy8gVXNlIG9uY2xpY2sgaW5zdGVhZCBvZiBldmVudExpc3RlbmVyXG4gICAgLy8gQXZvaWQgbGlzdGVuZXIgZ2V0dGluZyBzdGFja2VkIG11bHRpcGxlIHRpbWVzIG9uIHRoZSBzYW1lIGJ1dHRvbi4gXG4gICAgLy8gVGhpcyBjYXVzZXMgaGFuZGxlQW5zd2VyU3VibWlzc2lvbigpIHRvIGJlIGNhbGxlZCBtb3JlIHRoYW4gb25jZSDigJQgZXZlbiB3aXRoIG91dGRhdGVkIHN0YXRlLiBcbiAgICBzdWJtaXRCdG4ub25jbGljayA9IGhhbmRsZUFuc3dlclN1Ym1pc3Npb247XG5cbiAgICAvLyBQcmVwYXJlIGFuZCBzaG93IHRoZSBxdWVzdGlvbnNcbiAgICBjb25zdCBxdWVzdGlvbnMgPSBhd2FpdCBwcmVwYXJlUXVlc3Rpb25TZXQoc3ViamVjdCk7XG4gICAgc2hvd1F1ZXN0aW9uKGN1cnJlbnRRdWVzdGlvbkluZGV4LCBxdWVzdGlvbnMpO1xuXG4gICAgLy8gSGFuZGxlIGFuc3dlciBzdWJtaXRcbiAgICBmdW5jdGlvbiBoYW5kbGVBbnN3ZXJTdWJtaXNzaW9uKCkge1xuICAgICAgICBjb25zdCB1c2VyQW5zd2VyID0gYW5zd2VySW5wdXQudmFsdWU7XG4gICAgICAgIGNvbnN0IGlzVmFsaWQgPSBpc0Fuc3dlclZhbGlkKHVzZXJBbnN3ZXIsIHF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JbmRleF0pO1xuXG4gICAgICAgIGhhbmRsZUFuc3dlckZlZWRiYWNrKGlzVmFsaWQpO1xuXG4gICAgICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgICAgICAgY29ycmVjdEFuc3dlci5jbGFzc0xpc3QucmVtb3ZlKFwiaW52aXNpYmxlXCIpO1xuICAgICAgICAgICAgY29ycmVjdEFuc3dlci5pbm5lclRleHQgPSBgQ29ycmVjdCBBbnN3ZXI6ICR7cXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbkluZGV4XS5BbnN3ZXJ9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIHN1Ym1pdEJ0bi5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBhbnN3ZXJJbnB1dC5jbGFzc0xpc3QucmVtb3ZlKElOQ09SUkVDVF9CT1JERVJfQ09MT1IsIENPUlJFQ1RfQk9SREVSX0NPTE9SKTtcbiAgICAgICAgICAgIGNvcnJlY3RBbnN3ZXIuY2xhc3NMaXN0LmFkZChcImludmlzaWJsZVwiKTtcbiAgICAgICAgICAgIHN1Ym1pdEJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICBtb3ZlVG9OZXh0UXVlc3Rpb24oKTtcbiAgICAgICAgfSwgMjAwMCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbW92ZVRvTmV4dFF1ZXN0aW9uKCkge1xuICAgICAgICBjdXJyZW50UXVlc3Rpb25JbmRleCsrO1xuICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uSW5kZXggPCBxdWVzdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBzaG93UXVlc3Rpb24oY3VycmVudFF1ZXN0aW9uSW5kZXgsIHF1ZXN0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkFsbCBxdWVzdGlvbnMgY29tcGxldGVkIVwiKTtcbiAgICAgICAgICAgIHJlc3VsdHNWaWV3KHN1YmplY3RzUGFnZSwgcXVlc3Rpb25zUGFnZSwgc2NvcmUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd1F1ZXN0aW9uKGluZGV4OiBudW1iZXIsIHF1ZXN0aW9uczogQmFzZVF1ZXN0aW9uVHlwZVtdKSB7XG4gICAgICAgIGNvbnN0IHF1ZXN0aW9uVGV4dEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJxdWVzdGlvbi10ZXh0XCIpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBjb25zdCBjaG9pY2VzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjaG9pY2VzLWNvbnRhaW5lclwiKSBhcyBIVE1MRWxlbWVudDtcblxuICAgICAgICBjb25zdCBxID0gcXVlc3Rpb25zW2luZGV4XTtcbiAgICAgICAgcXVlc3Rpb25UZXh0RWwuaW5uZXJUZXh0ID0gcS5RdWVzdGlvbjtcbiAgICAgICAgYW5zd2VySW5wdXQudmFsdWUgPSBcIlwiO1xuICAgICAgICBjaG9pY2VzQ29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XG5cbiAgICAgICAgLy8gVE9ETzogSGFuZGxlIG11bHRpcGxlIGNob2ljZVxuXG4gICAgICAgIC8vIFN0YXJ0IGNvdW50ZG93biB0aW1lciBvbiBlYWNoIHF1ZXN0aW9uXG4gICAgICAgIHN0YXJ0Q291bnRkb3duVGltZXIoaGFuZGxlQW5zd2VyU3VibWlzc2lvbik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGFuZGxlQW5zd2VyRmVlZGJhY2soaXNDb3JyZWN0OiBib29sZWFuKSB7XG4gICAgICAgIGlmIChpc0NvcnJlY3QpIHtcbiAgICAgICAgICAgIGFuc3dlcklucHV0LmNsYXNzTGlzdC5hZGQoQ09SUkVDVF9CT1JERVJfQ09MT1IpO1xuICAgICAgICAgICAgc2NvcmUrKztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFuc3dlcklucHV0LmNsYXNzTGlzdC5hZGQoSU5DT1JSRUNUX0JPUkRFUl9DT0xPUik7XG4gICAgICAgIH1cbiAgICB9XG5cbn0iXX0=